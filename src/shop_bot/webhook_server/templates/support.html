{% extends 'base.html' %}
{% block title %}Поддержка — Панель{% endblock %}

{% block content %}
<section class="section">
  <h1>Обращения в поддержку</h1>

  <div class="controls-row">
    <div class="filters">
      <a class="button {% if not filter_status %}button-primary{% endif %}" href="{{ url_for('support_list_page') }}">Все ({{ all_count }})</a>
      <a class="button {% if filter_status == 'open' %}button-primary{% endif %}" href="{{ url_for('support_list_page', status='open') }}">Открытые ({{ open_count }})</a>
      <a class="button {% if filter_status == 'closed' %}button-primary{% endif %}" href="{{ url_for('support_list_page', status='closed') }}">Закрытые ({{ closed_count }})</a>
    </div>
  </div>

  {% if tickets %}
  <div class="table-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Пользователь</th>
          <th>Тема</th>
          <th>Статус</th>
          <th>Обновлен</th>
          <th>Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for t in tickets %}
        <tr>
          <td>#{{ t.ticket_id }}</td>
          <td>{{ t.user_id }}</td>
          <td>{{ t.subject or 'Без темы' }}</td>
          <td>
            {% if t.status == 'open' %}
              <span class="badge badge-green"><span class="indicator indicator--green pulse"></span>Открыт</span>
            {% else %}
              <span class="badge"><span class="indicator indicator--gray"></span>Закрыт</span>
            {% endif %}
          </td>
          <td>{{ t.updated_at }}</td>
          <td>
            <a class="button button-small" href="{{ url_for('support_ticket_page', ticket_id=t.ticket_id) }}">Открыть</a>
            <form method="post" action="{{ url_for('delete_support_ticket_route', ticket_id=t.ticket_id) }}" style="display:inline-block" onsubmit="return confirm('Удалить тикет #{{ t.ticket_id }}? Это действие необратимо.');">
              <button type="submit" class="button button-small button-danger">Удалить</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="pagination">
    {% if current_page > 1 %}
      <a class="button" href="{{ url_for('support_list_page', status=filter_status, page=current_page-1) }}">Назад</a>
    {% endif %}

    <span>Стр. {{ current_page }} из {{ total_pages }}</span>

    {% if current_page < total_pages %}
      <a class="button" href="{{ url_for('support_list_page', status=filter_status, page=current_page+1) }}">Вперед</a>
    {% endif %}
  </div>
  {% else %}
    <p>Обращений пока нет.</p>
  {% endif %}
</section>
{% endblock %}
